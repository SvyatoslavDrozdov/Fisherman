# Albion fisherman
Данная программа позволяет ловить рыбу в автоматическом режиме в игре Albion online.
Процесс рыбалки состоит из следующих частей: перемещение вдоль некоторого водоема, закидывание удочки, определение состояния поплавка (дергается или покоится), и процесса вылавливания рыбы.

Опишем логику работы бота. 

Следующие пункты зациклены и работают в течение заранее заданного времени. Для извлечения информации из игры программа делает скрины экрана, а далее, при помощи библиотек cv2.matchTemplate и YOLOv8 извелкает информацию о положении интересующих тел.

1) **Перемещение**.

   
Бот циклически перемещается по заранее заданым точкам, расположенным вдоль водоема. Среди точек есть 2 типа: точки для рыбалки и промежуточные точки. Промежуточные точки нужны только как точки траектории, на точках рыбалки бот останавливается и начинает рыбачить.
Для навигации бот использует координаты относительного некоторого объекта на миникарте. Объект на миникарте ищется при помощи cv2.matchTemplate, который повзоялет найти заданную картинку на изображении прямым попиксельным сравнением. Кординатная система строится следующим образом: на миникарте выбирается некоторое тело назывваемое отсчетным, и измеряется координаты этого тела (верхнего левого угла) на миникарте в пикселях от начала миникарты. Миникарта в игре реализована так, что игрок всегда находится по центру, поэтому координаты отсчетного тела на миникарте можно однозначно связать с положением бота. С помощью этой однозначной связи можно определить куда на экране следует нажть мышкой так, что бы координаты отсчетного тела начали приближаться к заданным. Фактически при навигации происходит подгонка положения персонажа под такое положение, при котором миникарта принимает заданный вид.
Это подход позволяет не сбиваться боту, если в случае какого-либо события он отойдет от своей траектории. (Чего бы не было, задай мы последовательность координат мыши на экране, так как такая навигация никак бы не имогла учесть того, что происходит в игре)

3) Закидывание удочки происходит нажатием мыши в некотором заданном секторе перед персонажем. Точка в секторе выбирается случайно. Сектор задается в той же координатной системе, в которой происходит навигация бота для перемещения. В каждлй точки для рыбалки случайно выбирается число закидываний поплавка в некотором диапозоне.
   
4) Далее бот при помощи YOLOv8 определяет в каком состоянии находит поплавок: спокойно колышится, или дергается. Если дергается бот нажимае мышь в том же месте, куда закидывал удочку и начинается миниигра по вытаягиванию рыбы.
   
5) Сразу после того, как бот потянул леску он ждет появления окна минигры для вытягивания рыбы. Если оно не появляется, то он закидывает удочку заново. В случае обнаружения окна с минигрой бот при помощи cv2.matchTemplate определяет координаты игрового поплавка в минигре: если тот правее середины он отпускает мышь, если левее - нажимает. (Строго говоря есть некоторая задержка, связанная со скоростью обработки информации, обновлению скринов экрана и.т.д. поэтому в коде реализовано нажатие и отпускание с потенциальном учетом того, что положение изменилось за время прохождения одного цикла.)
   
Для запуска программы следует запустить файл *main.py*. 
Для построения нового пути работы бота следует запустить файл *write_way.py*. (Данный файл написан в черновом виде, но он выполняет необходимые функции.)

